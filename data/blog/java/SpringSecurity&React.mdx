---
title: SpringSecurity + React ì„¤ì •
date: '2023-07-25'
tags: ['SpringBoot', 'SpringSecurity', 'React']
draft: false
summary: 'CORS ë° Preflight Request ì´ìŠˆ í•´ê²°'
---

## SpringSecurity ì ìš©ê¸° (feat. SpringBoot3) ğŸ¥²

ê°œë°œí™˜ê²½ ì„¸íŒ…ì„ í•˜ê³  reactì™€ SpringBootë¥¼ ì—°ë™í•´ì„œ [CORS ì„¤ì •](https://devtella.vercel.app/blog/java/springboot&react)ê¹Œì§€ ë§ˆì³¤ë‹¤. Reactì™€ Springì€ ê°ê° **3000**ë²ˆê³¼ **8080** í¬íŠ¸ë¡œ ì‹¤í–‰í•˜ê²Œ ë˜ëŠ”ë°, ë‘ ê°œì˜ ë„ë©”ì¸ì€ í¬íŠ¸ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— SOP ë¬¸ì œê°€ ë°œìƒëœë‹¤. SOPë€ ê°„ëµí•˜ê²Œ ë™ì¼ ì¶œì²˜ ì •ì±…ìœ¼ë¡œ, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ `ìì‹ ì˜ ì¶œì²˜ì™€ ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ë§Œ` ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒì´ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— CORSë¥¼ í—ˆìš©í•´ ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

ğŸ‘‰ğŸ» [CORSë€?](https://devtella.vercel.app/blog/java/cors)

---

ì„¸íŒ… í›„ ì—¬ì°¨ì €ì°¨ SpringSecurityë¥¼ ì ìš© í›„ íšŒì›ê°€ì…ì„ ì‹œë„í•˜ë ¤ëŠ”ë°, 

```js
const signUp = () => {
    axios.post('http://localhost:8080/memebers/joinProc', data)
        .then((response) => {
            setData(response.data);
        })
}
```
í”„ë¡ íŠ¸ë‹¨ì—ì„œ ìœ„ì™€ ê°™ì€ api í˜¸ì¶œ ì‹œ ì ìš© ì „ì—ëŠ” ë‚˜íƒ€ë‚˜ì§€ ì•Šë”ë‹ˆ ê°‘ìê¸° ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. **ì—ëŸ¬ ì½”ë“œ 401, ìš”ì²­ ë©”ì„œë“œ OPTION, prefilght**ì— ì§‘ì¤‘!

![image](https://github.com/subtitle1/subtitle1/assets/87356533/9eed6628-8631-4e03-8d40-77b18870aa20)
![image](https://github.com/subtitle1/subtitle1/assets/87356533/d420ef85-3bc8-44ec-858f-2a7b50acb4fd)
![image](https://github.com/subtitle1/subtitle1/assets/87356533/14e17fcc-ab87-436b-bf6b-e8864a2759a4)

## SpringSecurityì˜ í•„í„°

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” [Filter](https://devtella.vercel.app/blog/java/security)ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. í•„í„°ë€ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿(Dispatcher Servlet)ì— ìš”ì²­ì´ ì „ë‹¬ë˜ê¸° ì „, í›„ë¡œ url íŒ¨í„´ì— ë§ëŠ” ìš”ì²­ì— ëŒ€í•´ ë¶€ê°€ ì‘ì—…ì„ í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. ëŒ€ëµì ìœ¼ë¡œ ì–´ë– í•œ http ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ `filter -> dispatcher servlet -> interceptor -> controller` ìˆœìœ¼ë¡œ ì²˜ë¦¬ê°€ ëœë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì ì¸ì¦/ì¸ê°€ë¥¼ ìœ„í•œ í”„ë ˆì„ì›Œí¬ì¸ ìŠ¤í”„ë§ ìŠ¤íë¦¬í‹°ì˜ í•„í„°ì—ì„œë¶€í„° ê±¸ëŸ¬ì ¸ 401 ì—ëŸ¬(ìœ íš¨í•œ ì¸ì¦ ìê²© ì¦ëª…ì´ ì—†ìŒ)ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ë‹¤. 

## 401ì€ ì•Œê² ëŠ”ë°, Preflight Requestì€ ë­˜ê¹Œ? ğŸ”
prefilght requestëŠ” ì‚¬ì „ ìš”ì²­ì„ ì˜ë¯¸í•œë‹¤. ì‹¤ì œ ìš”ì²­ ì „ì— ìš”ì²­ì´ ìœ íš¨í•œì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë¸Œë¼ìš°ì €ê°€ ë³´ë‚´ëŠ” ìš”ì²­ìœ¼ë¡œ, `OPTIONS` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤. í™•ì¸ í›„ì—ì•¼ ì‹¤ì œ ìš”ì²­ì´ ì§„í–‰ë˜ëŠ” ê²ƒì´ë‹¤! ì¦‰ prefilght requestê°€ ì´ë¤„ì§€ë ¤ë©´ ì„œë²„ì—ì„œ OPTIONS ë©”ì„œë“œë¥¼ í—ˆìš©í•´ ì£¼ì–´ì•¼ í•œë‹¤. 

## SpringSecurity ì„¤ì •í•˜ê¸°

- **gradle**

ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì ìš©ì„ ìœ„í•´ ì˜ì¡´ì„±ì„ ë¨¼ì € ì¶”ê°€í•´ ì£¼ì.
```
implementation 'org.springframework.boot:spring-boot-starter-security'
```

- **SpringSecurity Config**

HttpMethod.OPTIONS ë©”ì†Œë“œ í—ˆìš©ì‹œì¼œì£¼ê¸°!

```java {1,3-4} showLineNumbers
@Configuration
@EnableMethodSecurity
public class SpringSecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .httpBasic().disable()
                .csrf().disable().cors().disable()
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)

                .and()
                .authorizeHttpRequests()
                .requestMatchers(HttpMethod.OPTIONS, "/**").permitAll() // Preflight Request í—ˆìš©í•´ì£¼ê¸°
                .requestMatchers("/**").permitAll(); // ê¶Œí•œ ìƒê´€(403 ì—ëŸ¬ ë°©ì§€)ì—†ì´ ëª¨ë“  url ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„ì‹œì ìœ¼ë¡œ ì¶”ê°€

        return http.build();
    }
}
```

ğŸ‘‰ğŸ» [ì„¤ì • ì°¸ê³  ë¸”ë¡œê·¸](https://nahwasa.com/entry/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-30%EC%9D%B4%EC%83%81-Spring-Security-%EA%B8%B0%EB%B3%B8-%EC%84%B8%ED%8C%85-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0)