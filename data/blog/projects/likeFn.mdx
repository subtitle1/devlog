---
title: ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°
date: '2022-01-28'
tags: ['Java', 'SpringBoot', 'jquery', 'javascript']
draft: false
summary: ''
---

## ì¢‹ì•„ìš” ê¸°ëŠ¥ ë¡œì§ í”Œë¡œìš°
![image](https://user-images.githubusercontent.com/87356533/152679003-bd18964b-8ec3-4d6b-8cc2-8ae9eb40e314.png)


ì˜í™” ëª©ë¡ ë° ì˜í™” ìƒì„¸ í˜ì´ì§€ì—ì„œ í•˜íŠ¸ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ, í•˜íŠ¸ê°€ ì±„ì›Œì§€ë©° ìˆ«ìë„ +1 ì¦ê°€ë˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ë‹¤. ìƒê°ë³´ë‹¤ ì‰½ê³  ë¹ ë¥´ê²Œ ë§Œë“¤ì–´ì„œ ê³µìœ í•˜ê³ ì ì“°ëŠ” í¬ìŠ¤íŒ….

![image](https://user-images.githubusercontent.com/87356533/151699211-1b03a439-b4e7-477b-bc63-b6c13ed09d7c.png)

## í…Œì´ë¸” êµ¬ì¡°

í…Œì´ë¸”ì€ **customer_no**ì™€ **movie_no**ë¡œë§Œ êµ¬ì„±ëœë‹¤.

## movieMapper

```java
@Mapper
    public interface MyMovieMapper {

        void saveLike(MyMovie myMovie);
        void upLike(int movieNo);
        void deleteLike(MyMovie myMovie);
        void downLike(int movieNo);
        int getLikeCount(int movieNo);
        List<MyMovie> getMyMovies(int customerNo);
    }
```

## **2. Mapper sql**

sqlë¬¸ì€ ì¢‹ì•„ìš”ë¥¼ ì¶”ê°€í•˜ëŠ” sqlë¬¸ë§Œ ì˜ˆì‹œë¡œ ë“¤ì—ˆë‹¤. ì¢‹ì•„ìš”ë¥¼ ì‚­ì œí•˜ëŠ” sqlë¬¸ì€ ë°˜ëŒ€ë¡œ í•˜ë©´ ëœë‹¤. getMyMoviesëŠ” ì˜í™” ëª©ë¡ í˜ì´ì§€ì— ë“¤ì–´ê°”ì„ ë•Œ, ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ğŸ’œí•œ ì˜í™” ëª©ë¡ë§Œ ì±„ì›Œì§„ í•˜íŠ¸ë¡œ ë„ì›Œë†“ê¸° ìœ„í•´ ì‘ì„±í•œ sqlì´ë‹¤. ë˜, ë§¨ ë§ˆì§€ë§‰ì˜ getLikeCount êµ¬ë¬¸ì€ ì˜í™” í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì˜í™”ë²ˆí˜¸ì˜ ì¢‹ì•„ìš” ê°œìˆ˜ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ êµ¬ë¬¸ì´ë‹¤.

```xml
	<insert id="saveLike" parameterType="com.example.vo.MyMovie">
		insert into my_movie
		(customer_no, movie_no)
		values
		(#{customerNo}, #{movieNo})
	</insert>
	
	<update id="upLike" parameterType="int">
		update movie
		set 
			movie_total_liked = movie_total_liked + 1
		where movie_no = #{value}
	</update>

    <select id="getMyMovies" parameterType="int" resultType="com.example.vo.MyMovie">
		select movie_no movieNo
		from my_movie
		where customer_no = #{value}
	</select>

    <select id="getLikeCount" parameterType="int" resultType="int">
		select movie_total_liked
		from movie
		where movie_no = #{value}
	</select>
```

## **3. Service**

```java
    @Service
    @Transactional
    public class MyMovieService {

        @Autowired
        private MyMovieMapper myMovieMapper;
        
        // ì¢‹ì•„ìš” ê°œìˆ˜ ì—…
        public MyMovie upLike(int customerNo, int movieNo) {

            MyMovie liker = new MyMovie();
            liker.setCustomerNo(customerNo);
            liker.setMovieNo(movieNo);
            
            myMovieMapper.saveLike(liker);
            myMovieMapper.upLike(movieNo);
            
            return liker;
        }

        // ì˜í™”ì— í•´ë‹¹í•˜ëŠ” ì¢‹ì•„ìš” ê°œìˆ˜ ë°˜í™˜
        public int getLikeCount(int movieNo) {
            return myMovieMapper.getLikeCount(movieNo);
        }
        
        // ì‚¬ìš©ìê°€ ì¢‹ì•„ìš” ëˆ„ë¥¸ ì˜í™” ëª©ë¡ ë°˜í™˜
        public List<MyMovie> getMyMovies(int customerNo) {
            return myMovieMapper.getMyMovies(customerNo);
        }
    }
```


## **4. Controller**

ë°ì´í„°ì˜ ì‘ë‹µì„ ì •í˜•í™”ì‹œí‚¤ê¸° ìœ„í•´ ResponseDtoë¥¼ ì‚¬ìš©í•´ì„œ json í˜•íƒœë¡œ ì‘ë‹µì„ ë³´ë‚¸ë‹¤. ì‚¬ìš©ìê°€ ì²˜ìŒ ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆŒë €ì„ ë•ŒëŠ” PostMappingìœ¼ë¡œ í…Œì´ë¸”ì— insertê°€ ë˜ê³ , ë°˜ëŒ€ë¡œ ë‹¤ì‹œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•ŒëŠ” DeleteMappingìœ¼ë¡œ í…Œì´ë¸”ì—ì„œ ì‚­ì œë˜ëŠ” êµ¬ì¡°ì´ë‹¤.

```java
    @RestController
    @RequestMapping("/rest")
    public class MyMovieRestController {

        @Autowired
        private MyMovieService myMovieService;
        
        // ì¢‹ì•„ìš” ì¶”ê°€
        @PostMapping("/like")
        public ResponseDto<Map<String, Object>> like(@LoginedUser Customer customer, int movieNo) {
            
            if (customer == null) {
                throw new LoginErrorException("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
            }
            
            ResponseDto<Map<String, Object>> response = new ResponseDto<>();
            
            MyMovie liker = myMovieService.upLike(customer.getNo(), movieNo);
            int likeCount = myMovieService.getLikeCount(movieNo);
            
            response.setStatus(true);
            response.setItems(Map.of("liker", liker, "likeCount", likeCount));
            
            return response;
        }

        // ì¢‹ì•„ìš” ì‚­ì œ ìƒëµ

        // ì¢‹ì•„ìš” ëˆ„ë¥¸ ì˜í™” ëª©ë¡ë§Œ ë°˜í™˜
        @GetMapping("/myMovies") 
        public ResponseDto<List<MyMovie>> myMovies(@LoginedUser Customer customer) {
            
            ResponseDto<List<MyMovie>> response = new ResponseDto<>();
            List<MyMovie> movies = myMovieService.getMyMovies(customer.getNo());
            
            if (movies == null) {
                response.setStatus(false);
                return response;
            }
            
            response.setStatus(true);
            response.setItems(movies);
            
            return response;
        }   
    }
```

## **5. js**

ëŒ€ë§ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ + jquery + jspë¥¼ ì‚¬ìš©í•œ ì½”ë“œ...! ë‹¤ë¥¸ ê±´ ê¸ˆë°© í–ˆëŠ”ë° ì´ ë¶€ë¶„ì´ ì œì¼ ê¹Œë‹¤ë¡œì› ë˜ ê²ƒ ê°™ë‹¤. ì˜í™” ëª©ë¡ì„ ë³´ì—¬ ì£¼ê¸° ì „ì— ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ í•˜íŠ¸ ëˆ„ë¥¸ ê²Œì‹œê¸€ì„ ì¡°íšŒí•´ì„œ ë¦¬ìŠ¤íŠ¸ì— ë„ìš´ë‹¤.

```javascript
    <script>
        $(function() {

            showMyMovies();   

            function showMyMovies() {
                $.ajax({
                    type: "get",
                    url: "/rest/myMovies",
                    success: function(response) {
                        if (response.status) {
                            let movieNo = (response.items.map(item => item.movieNo));

                            $.each(movieNo, function(index, movie) {
                                $("#btn-"+movie).find('img').attr('src', "/resources/images/movie/like.png");
                            })
                        }
                    }
                })
            };
        })
    </script>
```


ì•„ë˜ ì½”ë“œëŠ” ì¢‹ì•„ìš” í† ê¸€ ë²„íŠ¼ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤. ì˜í™” ë¦¬ìŠ¤íŠ¸ë„ ajaxë¡œ ê°€ì ¸ì™”ê¸° ë•Œë¬¸ì— `$(".btn-like").function() {}`ê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. \<div class="poster">(ajaxë¡œ ìƒì„±ëœ ë¶€ë¶„ì´ ì•„ë‹Œ, ê¸°ì¡´ html ì½”ë“œì— ì¡´ì¬í•˜ëŠ” ë¶€ë¶„) í•˜ë‹¨ì— ìœ„ì¹˜í•œ \<button class="btn-like"> ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ í•´ë‹¹ ê¸°ëŠ¥ì´ ì‘ë™ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— **jqueryì˜ on.('click')** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì˜€ë‹¤. ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì¢‹ì•„ìš” ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, ì„¸ì…˜ì—ì„œ ì¡°íšŒí•œ ê²°ê³¼ê°€ nullì´ë©´ ì‚¬ì§„ê³¼ ê°™ì´ ì—ëŸ¬ ëª¨ë‹¬ì°½ì´ ë„ì›Œì§€ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤. 

![image](https://user-images.githubusercontent.com/87356533/151700840-40e5771f-7107-417a-89a6-24a08ca44dc1.png)

```javascript
    <script>
        $(".poster").on('click', '.btn-like', function() {
			
			let movieNo = $(this).attr("data-no");
			let button = $(this);
			let unlike = "/resources/images/movie/unlike.png"; // ë¹„ì›Œì§„ í•˜íŠ¸
			let like = "/resources/images/movie/like.png"; // ì±„ì›Œì§„ í•˜íŠ¸
			
			if (button.find('img').attr('src') == unlike) {
				
				$.ajax({
					type: "post",
					url: "/rest/like",
					data: {movieNo: movieNo},
					datType: "json",
					success: function(response) {
						if (response.error) {
							$("#span-error").text(response.error);
							errorModal.show();
							
							$("#submit").click(function() {
								errorModal.hide();
							})
							
							return;
						}
						button.find('span').text(response.items.likeCount);
						button.find('img').attr("src", like);
					}
				})
			} else {
				$.ajax({
					type: "delete",
					url: "/rest/like",
					data: {movieNo: movieNo},
					datType: "json",
					success: function(response) {
						button.find('span').text(response.items.likeCount);
						button.find('img').attr("src", unlike);
					}
				})
			}
		});
    </script>
```