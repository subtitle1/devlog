---
title: ê´€ëŒí‰ ë“±ë¡ ì „ exception ì²˜ë¦¬í•˜ê¸°
date: '2022-02-04'
tags: ['Java', 'SpringBoot']
draft: false
summary: ''
---

ê´€ëŒí‰ ë“±ë¡ ì‹œ ì‹¤ì œ ì˜ˆë§¤ ì—¬ë¶€, ì‘ì„± ë¦¬ë·° ì—¬ë¶€ë¥¼ ì²´í¬í•´ì„œ exceptionì„ ë°œìƒì‹œí‚¤ë„ë¡ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œë¥¼ ë‹¤ì‹œ ë³µìŠµí•´ ë³´ë ¤ê³  í•œë‹¤. ë¡œì§ í”Œë¡œìš°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

![Untitled Diagram drawio (1)](https://user-images.githubusercontent.com/87356533/155128769-6fa2182a-58ba-4872-b9b0-c69c04d33049.png)

ì²«ë²ˆì§¸ë¡œ, í•´ë‹¹ ê³ ê°ì˜ ì˜ˆë§¤ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ì¿¼ë¦¬ë¬¸ ë° ì„œë¹„ìŠ¤ ë¡œì§ì´ë‹¤. erdëŠ” ì•„ë˜ì™€ ê°™ë‹¤. ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ê³ ì í•˜ëŠ” ì˜í™”ì˜ ë²ˆí˜¸ì™€ ê³ ê°ë²ˆí˜¸ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— í‹°ì¼“ í…Œì´ë¸”ê³¼ ìƒì˜ì‹œê°„í‘œ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ì˜€ë‹¤.

![image](https://user-images.githubusercontent.com/87356533/155129791-37252a53-8c35-4efb-bfa3-6aa8b0b02ff6.png)

## sql
ê°™ì€ ì˜í™”ë¥¼ ì—¬ëŸ¬ ë²ˆ ì˜ˆë§¤í–ˆì„ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— listë¡œ ë°›ì•„ì™”ë‹¤. 

```sql 
<!-- List<String> getQualification(@Param("customerNo") int customerNo, @Param("movieNo") int movieNo); -->
	<select id="getQualification" resultType="string">
		select 
   			t.ticket_cancelled ticketCancelled
		from 
		    show_schedule s, ticket t
		where 
		    s.show_schedule_no = t.show_schedule_no
			and t.customer_no = #{customerNo}
			and s.movie_no = #{movieNo}
			and t.ticket_cancelled = 'N'
	</select>
```

## Service
ì„œë¹„ìŠ¤ ë¡œì§ì€ isReserved, isWrited ë‘ ê°€ì§€ë¡œ êµ¬í˜„í•˜ì˜€ë‹¤. isReservedëŠ” ë°˜í™˜í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ trueë¥¼, isWritedëŠ” ì‘ì„±ëœ ê´€ëŒí‰ì´ ì—†ë‹¤ë©´ trueë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œì´ë‹¤.

```java
	/**
	 * ì‚¬ìš©ì ë²ˆí˜¸ë¡œ í•´ë‹¹ ì˜í™”ì— ëŒ€í•œ ì˜ˆë§¤ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
	 * @param customerNo
	 * @param movieNo
	 * @return
	 */
	public boolean isReserved(int customerNo, int movieNo) {
		List<String> isReserved = reviewMapper.getQualification(customerNo, movieNo);
		return !isReserved.isEmpty();
	}
	
	/**
	 * ì‚¬ìš©ì ë²ˆí˜¸ì™€ ì˜í™” ë²ˆí˜¸ë¡œ í•´ë‹¹ ì˜í™”ì— ì‘ì„±í•œ ë¦¬ë·°ê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.
	 * @param customerNo
	 * @param movieNo
	 * @return
	 */
	public boolean isWrited(int customerNo, int movieNo) {
		Review review = reviewMapper.getMyReviewByMovieNo(customerNo, movieNo);
		return review == null;
	}
```

## Controller
ë‹¤ìŒì˜ ì½”ë“œëŠ” exception í•¸ë“¤ëŸ¬ì´ë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ ì¸¡ì—ì„œ ReviewErrorException ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¬ ë•Œ ë°”ë¡œ ì•„ë˜ì˜ exception í•¸ë“¤ëŸ¬ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤. ì˜ˆë§¤ë¥¼ í•˜ì§€ ì•Šì•˜ê±°ë‚˜, ì´ë¯¸ ì‘ì„±ëœ ê´€ëŒí‰ì´ ìˆë‹¤ë©´ exceptionì„ ë°œìƒì‹œí‚¨ë‹¤. 

ì˜ˆë§¤ë¥¼ í•˜ì§€ ì•Šê³  ê´€ëŒí‰ ì“°ê¸° ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ë°›ì•„ì˜¤ëŠ” ì‘ë‹µì€ ë‹¤ìŒ ì‚¬ì§„ê³¼ ê°™ë‹¤. statusëŠ” false, errorì—ëŠ” exception ì‹œ ë„ìš¸ ë©”ì„¸ì§€, itemsëŠ” null ê°’ì´ ì „ë‹¬ëœë‹¤. ë°˜ëŒ€ë¡œ ì˜ˆë§¤ë¥¼ ì´ë¯¸ í–ˆì„ ê²½ìš°ì—ëŠ” itemsì— message: trueê°€ ë°˜í™˜ì´ ë˜ê²Œë” êµ¬í˜„í•˜ì˜€ë‹¤. 

![image](https://user-images.githubusercontent.com/87356533/155131570-c77c1866-1d6d-4361-b651-343d3ec1ebfc.png)

```java
@ExceptionHandler(ReviewErrorException.class)
public @ResponseBody ResponseDto<?> ReviewExceptionHandler(ReviewErrorException e) {
    ResponseDto<?> response = new ResponseDto<>();
    
    response.setStatus(false);
    response.setError(e.getMessage());
    
    return response;
}
```

ë‹¤ìŒì€ **/rest/check** url ìš”ì²­ì´ ì™”ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì½”ë“œì´ë‹¤. 

```java
    @RestController
    @RequestMapping("/rest")
    public class ReviewRestController {
        @GetMapping("/check")
        public ResponseDto<Map<String, Object>> checkQualification(@LoginedUser Customer customer, int movieNo) {
            
            ResponseDto<Map<String, Object>> response = new ResponseDto<>();
            HashMap<String, Object> items = new HashMap<>();
            
            boolean isReserved = reviewService.isReserved(customer.getNo(), movieNo);
            boolean isWrited = reviewService.isWrited(customer.getNo(), movieNo);
            
            if (isReserved) {
                items.put("message", true);
            } else {
                throw new ReviewErrorException("ê´€ëŒí‰ì€ ì‹¤ê´€ëŒ ì´í›„ ì‘ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            }
            
            if (isWrited) {
                items.put("message", true);
            } else {
                throw new ReviewErrorException("ì´ë¯¸ ì‘ì„±í•œ ê´€ëŒí‰ì´ ìˆìŠµë‹ˆë‹¤.");
            }
            
            response.setStatus(true);
            response.setItems(items);
            
            return response;
        }
    }
```

## JSP
jspì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì‘ì—…í•˜ì˜€ëŠ”ë°, ê´€ëŒí‰ ì“°ê¸° ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ajax ìš”ì²­ì´ ì˜¤ë„ë¡ êµ¬í˜„ì„ í–ˆê³  ì‘ë‹µìœ¼ë¡œ ë°›ì€ itemsê°€ ì¡´ì¬í•œë‹¤ë©´ ê´€ëŒí‰ ëª¨ë‹¬ì„ ë„ìš°ê³ , itemsì´ ì¡´ì¬í•˜ì§€ ì•Šë‹¤ë©´ exception ì‹œì˜ ë©”ì„¸ì§€ë¥¼ ì˜¤ë¥˜ ëª¨ë‹¬ì— ë„ìš°ë„ë¡ í•˜ì˜€ë‹¤.

```html
<script>
    $(".review-btn").click(function() {
        $.ajax({
            type: "get",
            url: "/rest/check",
            data: {movieNo: movieId},
            dataType: 'json',
            async: false,
            success: function (response) {
                if (response.items) {
                    reviewModal.show();
                } else {
                    showError(response.error);
                    return; 
                }
            }
        })
    })
</script>
```

ì‚¬ì‹¤ ìœ„ì˜ ì½”ë“œë„ ì—¬ëŸ¬ ë²ˆ ìˆ˜ì •í•œ ì½”ë“œì´ê³ , êµ¬í˜„ì€ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆì§€ë§Œ ì¡°ê¸ˆ ë” ì¢‹ì€ ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ì—†ì—ˆë‚˜ ì‹¶ì€ ê³ ë¯¼ì„ í•˜ê³  ìˆë‹¤ ğŸ¤”ğŸ¤”